// Script validation cho há»‡ thá»‘ng 19 nhÃ³m chuáº©n
// Generated: Auto-generated by system

const fs = require('fs');
const path = require('path');

console.log('ðŸ” Báº®T Äáº¦U VALIDATION Há»† THá»NG 19 NHÃ“M CHUáº¨N...');

async function validateSystem() {
    const results = {
        success: true,
        errors: [],
        warnings: [],
        summary: {}
    };

    try {
        // 1. Kiá»ƒm tra file DIM_USERS_19_NHOM_CHUAN.xlsx
        const dimUsersFile = path.join(__dirname, '../data/DIM_USERS_19_NHOM_CHUAN.xlsx');
        if (!fs.existsSync(dimUsersFile)) {
            results.errors.push('âŒ File DIM_USERS_19_NHOM_CHUAN.xlsx khÃ´ng tá»“n táº¡i');
            results.success = false;
        } else {
            console.log('âœ… File DIM_USERS_19_NHOM_CHUAN.xlsx: OK');
        }

        // 2. Kiá»ƒm tra file employees-19nhom.json
        const employeesFile = path.join(__dirname, '../frontend/public/data/employees-19nhom.json');
        if (!fs.existsSync(employeesFile)) {
            results.errors.push('âŒ File employees-19nhom.json khÃ´ng tá»“n táº¡i');
            results.success = false;
        } else {
            // Äá»c vÃ  validate dá»¯ liá»‡u
            const employeesData = JSON.parse(fs.readFileSync(employeesFile, 'utf8'));
            console.log(`âœ… File employees-19nhom.json: ${employeesData.length} records`);
            
            // Kiá»ƒm tra mapping
            const unmapped = employeesData.filter(emp => emp.nhomChuan === 'CHÆ¯A MAPPING');
            if (unmapped.length > 0) {
                results.errors.push(`âŒ CÃ³ ${unmapped.length} nhÃ¢n viÃªn chÆ°a Ä‘Æ°á»£c mapping`);
                results.success = false;
            } else {
                console.log('âœ… Mapping: 100% nhÃ¢n viÃªn Ä‘Ã£ cÃ³ nhÃ³m chuáº©n');
            }

            // Thá»‘ng kÃª nhÃ³m
            const groupStats = {};
            employeesData.forEach(emp => {
                groupStats[emp.nhomChuan] = (groupStats[emp.nhomChuan] || 0) + 1;
            });
            results.summary.groupDistribution = groupStats;
            console.log(`âœ… PhÃ¢n bá»•: ${Object.keys(groupStats).length} nhÃ³m khÃ¡c nhau`);
        }

        // 3. Kiá»ƒm tra config files
        const configFile = path.join(__dirname, '../frontend/src/config/nhom-19-config.js');
        if (!fs.existsSync(configFile)) {
            results.errors.push('âŒ File nhom-19-config.js khÃ´ng tá»“n táº¡i');
            results.success = false;
        } else {
            console.log('âœ… File config: nhom-19-config.js OK');
        }

        const mappingFile = path.join(__dirname, '../frontend/src/config/nhom-mapping.js');
        if (!fs.existsSync(mappingFile)) {
            results.errors.push('âŒ File nhom-mapping.js khÃ´ng tá»“n táº¡i');
            results.success = false;
        } else {
            console.log('âœ… File mapping: nhom-mapping.js OK');
        }

        // 4. Kiá»ƒm tra Dashboard component
        const dashboardFile = path.join(__dirname, '../frontend/src/components/Dashboard/Dashboard19Nhom.jsx');
        if (!fs.existsSync(dashboardFile)) {
            results.errors.push('âŒ Dashboard19Nhom.jsx khÃ´ng tá»“n táº¡i');
            results.success = false;
        } else {
            console.log('âœ… Component Dashboard19Nhom.jsx: OK');
        }

        // 5. Kiá»ƒm tra App.js integration
        const appFile = path.join(__dirname, '../frontend/src/App.js');
        if (fs.existsSync(appFile)) {
            const appContent = fs.readFileSync(appFile, 'utf8');
            if (appContent.includes('Dashboard19Nhom')) {
                console.log('âœ… App.js: ÄÃ£ tÃ­ch há»£p Dashboard19Nhom');
            } else {
                results.warnings.push('âš ï¸ App.js: ChÆ°a import Dashboard19Nhom');
            }
        }

        // 6. Validation tá»•ng quÃ¡t
        if (results.success) {
            console.log('\nðŸŽ¯ Káº¾T QUáº¢ VALIDATION:');
            console.log('   âœ… Táº¥t cáº£ file cáº§n thiáº¿t Ä‘Ã£ tá»“n táº¡i');
            console.log('   âœ… Dá»¯ liá»‡u nhÃ¢n viÃªn Ä‘Ã£ Ä‘Æ°á»£c mapping 100%');
            console.log('   âœ… Config vÃ  component Ä‘Ã£ sáºµn sÃ ng');
            console.log('   âœ… Há»‡ thá»‘ng 19 nhÃ³m chuáº©n Ä‘Ã£ triá»ƒn khai thÃ nh cÃ´ng!');
            
            // Get employee count from file if exists
            let employeeCount = 0;
            if (fs.existsSync(employeesFile)) {
                const employeesData = JSON.parse(fs.readFileSync(employeesFile, 'utf8'));
                employeeCount = employeesData.length;
            }
            
            results.summary.totalEmployees = employeeCount;
            results.summary.totalGroups = Object.keys(results.summary.groupDistribution || {}).length;
            results.summary.mappingRate = '100%';
        }

        return results;

    } catch (error) {
        console.error('âŒ Lá»—i validation:', error);
        results.success = false;
        results.errors.push(`System error: ${error.message}`);
        return results;
    }
}

// Cháº¡y validation
if (require.main === module) {
    validateSystem().then(results => {
        if (!results.success) {
            console.log('\nâŒ VALIDATION THáº¤T Báº I:');
            results.errors.forEach(error => console.log(`   ${error}`));
            process.exit(1);
        }
        
        if (results.warnings.length > 0) {
            console.log('\nâš ï¸ Cáº¢NH BÃO:');
            results.warnings.forEach(warning => console.log(`   ${warning}`));
        }
    });
}

module.exports = { validateSystem };